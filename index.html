<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mental Health Chatbot + Disaster Predictor — Final Year Project</title>
  <meta name="description" content="Frontend prototype: mental health chatbot (sentiment detection + supportive responses) and disaster prediction (upload CSV, simple forecasting demo)." />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0f1724;--card:#111827;--muted:#9aa7d6;--text:#e6eefc;--accent:#6ea8fe;--success:#6ee7b7}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#07102b, #09142f);color:var(--text);min-height:100vh}
    .wrap{max-width:1100px;margin:28px auto;padding:20px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .title{font-weight:700;font-size:20px}
    .sub{color:var(--muted);font-size:13px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-top:18px}
    @media(max-width:980px){.grid{grid-template-columns:1fr}}
    .card{background:linear-gradient(180deg,#0b1324,#081022);border:1px solid rgba(120,150,255,0.06);padding:16px;border-radius:12px}
    .card h2{margin:0 0 8px}
    label{font-size:13px;color:var(--muted)}
    textarea,input,select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text);outline:none}
    .row{display:flex;gap:10px;margin-top:10px}
    .btn{background:linear-gradient(90deg,var(--accent),#9dd7ff);color:#07102b;padding:10px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
    .messages{max-height:320px;overflow:auto;padding:8px;display:flex;flex-direction:column;gap:8px;margin-top:8px}
    .msg{padding:10px;border-radius:10px;max-width:85%}
    .msg.user{background:#07203a;align-self:flex-end}
    .msg.bot{background:#092240;align-self:flex-start}
    .pill{display:inline-block;padding:6px 8px;border-radius:999px;background:#06122a;color:var(--muted);font-size:12px}
    .muted{color:var(--muted)}
    .kpi{display:flex;gap:12px;margin-top:10px}
    .kpi .cardk{background:#071729;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}
    canvas{width:100%;height:260px}
    footer{margin-top:18px;color:var(--muted);font-size:12px}
    .mono{font-family:ui-monospace,Menlo,Consolas,monospace;color:#bcd6ff}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <div class="title">Social Good Suite — Mental Health Chatbot + Disaster Predictor</div>
        <div class="sub">Prototype frontend for B.Tech (AI & DS) final year project. Push to GitHub as a single HTML demo.</div>
      </div>
      <div class="pill">v1.0 • Frontend-only</div>
    </header>

    <div class="grid">
      <!-- Mental Health Chatbot -->
      <section class="card" id="chat-card">
        <h2>🧡 Mental Health Chatbot</h2>
        <p class="muted">Detects sentiment, offers supportive replies and resources. Replace local logic with an LLM or sentiment API for production.</p>

        <div class="kpi">
          <div class="cardk"><div class="mono" id="sentiment-score">Score: 0</div><div class="muted">Sentiment</div></div>
          <div class="cardk"><div class="mono" id="mood">Mood: Neutral</div><div class="muted">Detected</div></div>
        </div>

        <div class="messages" id="messages" aria-live="polite"></div>

        <div style="margin-top:8px">
          <label for="user-input">Write to the chatbot (Tamil or English)</label>
          <textarea id="user-input" placeholder="I'm feeling stressed about exams..." rows="3"></textarea>
        </div>
        <div class="row" style="margin-top:8px">
          <button class="btn" id="send">Send</button>
          <button class="btn ghost" id="reset-chat">Reset</button>
          <select id="mode" style="width:180px">
            <option value="local">Local sentiment (demo)</option>
            <option value="api">Use Backend LLM (POST /api/chat)</option>
          </select>
        </div>
        <div style="margin-top:6px" class="muted">Tip: The local demo uses a small keyword-based sentiment analyzer to show concept flow. For EE/NLP, hook to a transformer model and add safety checks.</div>
      </section>

      <!-- Disaster Predictor -->
      <section class="card" id="disaster-card">
        <h2>🌊 Disaster Prediction (Flood / Cyclone / Earthquake) — Demo</h2>
        <p class="muted">Upload historical data (CSV with columns: date,value). The demo fits a simple moving-average forecast as a placeholder. Connect to a backend/ML model for real predictions.</p>

        <div style="margin-top:6px">
          <label for="csv-file">Upload CSV</label>
          <input id="csv-file" type="file" accept=".csv" />
        </div>
        <div class="row" style="margin-top:10px">
          <button class="btn" id="btn-parse">Parse & Plot</button>
          <button class="btn ghost" id="btn-forecast">Run Forecast (MA)</button>
          <button class="btn ghost" id="btn-export-csv">Export Preds</button>
        </div>
        <div style="margin-top:10px">
          <canvas id="chart"></canvas>
        </div>
        <div style="margin-top:8px" class="muted">API contract (example): POST /api/disaster/predict { series: [{date, value}], horizon } → returns {predictions:[{date,value}], warnings:[] }</div>
      </section>
    </div>

    <section class="card" style="margin-top:18px">
      <h2>📜 Activity Log</h2>
      <div id="log" class="mono" style="white-space:pre-wrap;max-height:200px;overflow:auto;padding:8px"></div>
    </section>

    <footer>README & GitHub instructions are included inside this HTML as comments. License: MIT.</footer>
  </div>

  <!--
  README (for GitHub)
  ===================
  Project: Social Good Suite — Mental Health Chatbot + Disaster Predictor
  This single-file demo provides a frontend prototype for two modules:
  1) Mental Health Chatbot: a small demo that detects sentiment using a keyword lexicon and returns supportive replies. For production, connect to an LLM (with safety), sentiment APIs, or a fine-tuned transformer.
  2) Disaster Prediction Demo: CSV upload + simple moving-average forecasting / plotting. For real deployment, replace the forecasting logic with time-series models (SARIMAX, Prophet, LSTM/Transformer) and use domain-specific datasets.

  How to publish on GitHub Pages:
  - Create a new repository on GitHub.
  - Add this file as index.html in the root.
  - Commit & push.
  - Settings -> Pages -> Deploy from branch -> select main branch, / (root). Save.
  - GitHub will provide a URL (your-username.github.io/repo-name/).

  Example backend routes (suggested):
  - POST /api/chat { message, history } -> { reply, sentiment_score, mood }
  - POST /api/disaster/predict { series:[{date,value}], horizon } -> { predictions:[{date,value}], warnings }

  Note on ethics & safety:
  - The mental health chatbot must include crisis resources and a clear disclaimer that it's not a replacement for professional help.
  - Log only anonymized data; if storing user input, obtain informed consent.
  - For disaster prediction, provide confidence intervals and avoid giving definitive instructions without domain expert verification.
  -->

  <script>
    // ===== Utilities =====
    const $ = (s)=>document.querySelector(s);
    const log = (m)=>{ const el = $('#log'); el.textContent += `[${new Date().toLocaleTimeString()}] ${m}\n`; el.scrollTop = el.scrollHeight; };

    // ===== Simple Sentiment Lexicon (tiny demo) =====
    // Positive and negative keywords; in practice use a model or local language lexicons (Tamil tokens included)
    const POS = ['good','happy','relieved','fine','ok','love','satisfied','பரவசம்','மகிழ்ச்சி','சந்தோஷம்'];
    const NEG = ['sad','depressed','stressed','anxious','worried','angry','tired','suicidal','hate','அழுத','வருத்தம்','பயம்'];

    function analyzeSentiment(text){
      const t = text.toLowerCase(); let score=0;
      POS.forEach(w=>{ if(t.includes(w)) score+=1 });
      NEG.forEach(w=>{ if(t.includes(w)) score-=1 });
      return score; // positive => positive mood, negative => negative
    }

    function moodFromScore(s){ if(s>1) return 'Positive'; if(s< -1) return 'Distressed'; if(s<0) return 'Negative'; return 'Neutral'; }

    function supportiveReply(mood){
      if(mood==='Distressed') return "I'm really sorry you're feeling this way. If you're in immediate danger, please contact local emergency services. Would you like some breathing exercises or to talk about what's bothering you?";
      if(mood==='Negative') return "I hear you — that's tough. Can you tell me more? Sometimes breaking the problem into small steps helps.";
      if(mood==='Positive') return "That's wonderful to hear! Would you like tips to keep this momentum?";
      return "Thanks for sharing. How can I support you right now?";
    }

    // ===== Chatbot UI logic =====
    const messagesEl = $('#messages');
    function appendMessage(text, who='bot'){
      const d = document.createElement('div'); d.className = 'msg '+(who==='user'?'user':'bot'); d.textContent = text; messagesEl.appendChild(d); messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    $('#send').addEventListener('click', async ()=>{
      const text = $('#user-input').value.trim(); if(!text) return;
      appendMessage(text,'user'); $('#user-input').value='';
      log('User sent: '+text.substring(0,80));

      const mode = $('#mode').value;
      if(mode==='local'){
        const score = analyzeSentiment(text);
        $('#sentiment-score').textContent = 'Score: '+score;
        const mood = moodFromScore(score);
        $('#mood').textContent = 'Mood: '+mood;
        const reply = supportiveReply(mood);
        await sleep(400);
        appendMessage(reply,'bot'); log('Bot reply (local).');
      }else{
        appendMessage('Thinking...','bot');
        try{
          const res = await fetch('/api/chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:text, history:[]} )});
          const j = await res.json();
          // expected: { reply, sentiment_score, mood }
          $('#sentiment-score').textContent = 'Score: '+(j.sentiment_score ?? 'n/a');
          $('#mood').textContent = 'Mood: '+(j.mood ?? 'n/a');
          // replace the last 'Thinking...' with reply
          const last = messagesEl.querySelector('.msg.bot:last-child'); if(last) last.textContent = j.reply;
          log('Bot reply (api).');
        }catch(err){ log('Chat API error: '+err.message); const last=messagesEl.querySelector('.msg.bot:last-child'); if(last) last.textContent='(error)'; }
      }
    });

    $('#reset-chat').addEventListener('click', ()=>{ messagesEl.innerHTML=''; $('#sentiment-score').textContent='Score: 0'; $('#mood').textContent='Mood: Neutral'; log('Chat reset.'); });

    function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }

    // ===== Disaster Predictor: CSV parsing + simple MA forecast =====
    let series = []; // [{date:Date, value:Number}]
    const fileEl = $('#csv-file');
    const chartCtx = document.getElementById('chart').getContext('2d');
    let chart=null;

    function parseCSV(text){
      // naive CSV parse: expects header with date,value
      const lines = text.trim().split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
      const data = []; for(let i=1;i<lines.length;i++){ const row = lines[i].split(','); const dt = new Date(row[0]); const v = Number(row[1]); if(!isNaN(dt.getTime()) && !isNaN(v)) data.push({date:dt, value:v}); }
      return data.sort((a,b)=>a.date-b.date);
    }

    $('#btn-parse').addEventListener('click', ()=>{
      const f = fileEl.files[0]; if(!f){ alert('Choose a CSV file first'); return; }
      const reader = new FileReader(); reader.onload = ()=>{
        try{ series = parseCSV(reader.result); if(series.length===0) throw new Error('No valid rows'); renderChart(series); log('CSV parsed: '+series.length+' rows'); }
        catch(err){ log('CSV parse error: '+err.message); alert('CSV parse error: '+err.message); }
      }; reader.readAsText(f);
    });

    function renderChart(data, preds=[]){
      const labels = data.map(d=>d.date.toISOString().slice(0,10));
      const values = data.map(d=>d.value);
      const predLabels = preds.map(p=>p.date.toISOString().slice(0,10));
      const predValues = preds.map(p=>p.value);
      if(chart) chart.destroy();
      chart = new Chart(chartCtx, {
        type: 'line', data: { labels: labels.concat(predLabels), datasets:[{label:'Historical',data:values,fill:false,tension:0.2},{label:'Forecast',data:new Array(values.length).fill(null).concat(predValues),fill:false,borderDash:[6,4]}] }, options:{responsive:true,scales:{x:{display:true},y:{display:true}}}
      });
    }

    // Simple moving-average forecast: horizon default 7
    function movingAverageForecast(data, horizon=7, window=3){
      if(data.length===0) return [];
      const vals = data.map(d=>d.value);
      const preds = [];
      let recent = vals.slice(-window);
      for(let i=0;i<horizon;i++){
        const avg = recent.reduce((a,b)=>a+b,0)/recent.length;
        const lastDate = data[data.length-1].date; const nextDate = new Date(lastDate.getTime() + (i+1)*24*3600*1000);
        preds.push({date: nextDate, value: Number(avg.toFixed(2))});
        recent = recent.slice(1).concat(avg);
      }
      return preds;
    }

    $('#btn-forecast').addEventListener('click', ()=>{
      if(series.length===0){ alert('No series loaded'); return; }
      const preds = movingAverageForecast(series, 14, 7);
      renderChart(series,preds); log('Forecast generated: '+preds.length+' steps (MA)');
      // enable export
      $('#btn-export-csv').disabled=false;
      // store predictions for export
      window.latestPreds = preds;
    });

    $('#btn-export-csv').addEventListener('click', ()=>{
      if(!window.latestPreds || window.latestPreds.length===0){ alert('No predictions to export'); return; }
      let csv = 'date,value\n'; window.latestPreds.forEach(p=>{ csv += p.date.toISOString().slice(0,10)+','+p.value+'\n'; });
      const blob = new Blob([csv],{type:'text/csv'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='predictions.csv'; a.click(); URL.revokeObjectURL(url);
      log('Predictions exported');
    });

    // load Chart.js from CDN dynamically
    (function loadChart(){ const s=document.createElement('script'); s.src='https://cdn.jsdelivr.net/npm/chart.js'; s.onload=()=>log('Chart.js loaded'); s.onerror=()=>log('Chart.js failed to load'); document.head.appendChild(s);} )();

    // small accessibility: send on Ctrl+Enter
    $('#user-input').addEventListener('keydown', (e)=>{ if(e.key==='Enter' && (e.ctrlKey||e.metaKey)){ e.preventDefault(); $('#send').click(); } });

    // initial log
    log('Demo loaded — ready.');

  </script>
</body>
</html>
